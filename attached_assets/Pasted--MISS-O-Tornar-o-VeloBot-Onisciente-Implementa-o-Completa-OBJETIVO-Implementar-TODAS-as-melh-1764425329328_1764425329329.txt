ü§ñ MISS√ÉO: Tornar o VeloBot Onisciente - Implementa√ß√£o Completa
OBJETIVO
Implementar TODAS as melhorias no VeloBot para que ele tenha conhecimento COMPLETO e PROFUNDO de TUDO que acontece na loja, com respostas formatadas de forma limpa e organizada.

CONTEXTO ATUAL
O VeloBot j√° tem acesso a: ve√≠culos, leads, observa√ß√µes, contas a pagar, comiss√µes e custos. Por√©m, faltam dados cr√≠ticos e a formata√ß√£o das respostas precisa melhorar.

MELHORIAS A IMPLEMENTAR
1. EXPANDIR DADOS DO CONTEXTO DO SISTEMA
Adicione ao contexto do chatbot (server/routes/ai.ts, endpoint /api/chatbot/message) as seguintes queries:

PRIORIDADE ALTA:

 Follow-ups: Buscar todos os follow-ups pendentes e vencidos
 Reminders: Buscar todos os lembretes ativos e pendentes
 Aprova√ß√µes de Custos: Buscar custos aguardando aprova√ß√£o (cost_approvals)
 Despesas Operacionais: Buscar despesas do m√™s (operational_expenses)
 Vendedores com M√©tricas: Lista completa de vendedores com n√∫mero de vendas, comiss√µes, convers√£o de leads
PRIORIDADE M√âDIA:

 Documentos Faltantes: Verificar quais ve√≠culos n√£o t√™m documenta√ß√£o completa
 Log de Atividades: √öltimas 50 atividades do sistema (activity_log)
 An√°lise Temporal: Tempo m√©dio de prepara√ß√£o, tempo m√©dio de venda, ve√≠culos parados h√° mais de X dias
2. MELHORAR CONSCI√äNCIA DE CONTEXTO
O VeloBot deve entender quando a conversa √© sobre um ve√≠culo espec√≠fico e manter esse contexto:

// Implementar:
1. Detectar ve√≠culo mencionado no hist√≥rico (ex: "Compass", "Onix")
2. Guardar refer√™ncia ao ve√≠culo em contexto
3. Quando perguntarem sobre custos/localiza√ß√£o/tempo, responder APENAS sobre aquele ve√≠culo
4. Detectar t√≥picos: custos, localiza√ß√£o, vendas, comiss√µes, status, follow-ups, documenta√ß√£o
3. CALCULAR TEMPO EM OFICINAS/LOCAIS
Para perguntas como "quanto tempo a Compass ficou na oficina do Aur√©lio?":

// Buscar hist√≥rico de movimenta√ß√£o (vehicle_history)
// Calcular dias entre cada mudan√ßa de localiza√ß√£o
// Agrupar por local f√≠sico (toPhysicalLocation)
// Responder: "Compass Sport Branca: 3 dias na Oficina Aur√©lio, 8 dias no Paulo"
4. MELHORAR FORMATA√á√ÉO DAS RESPOSTAS
Atualizar o veloStockSystemPrompt para incluir regras de formata√ß√£o:

Para respostas quantitativas (Quantos/Quanto):

Responda APENAS o n√∫mero, nada mais.
Exemplo: "3" ou "R$ 15.000"
Para respostas qualitativas (Quais/Liste/Detalhes):

Use formata√ß√£o limpa:
‚úÖ FORMATO CORRETO:
üöó Ve√≠culos em prepara√ß√£o:
‚Ä¢ Volkswagen Gol 2017 (Prata) - Placa OKG-0912
‚Ä¢ Fiat Palio 2019 (Branco) - Placa XYZ-1234
‚Ä¢ Chevrolet Onix 2020 (Preto) - Placa ABC-5678
‚ùå FORMATO ERRADO:
"Voc√™ tem 3 ve√≠culos em prepara√ß√£o: Gol, Palio e Onix. Se precisar de mais informa√ß√µes..."
5. RESPOSTAS COM INSIGHTS AUTOM√ÅTICOS
Quando responder sobre m√©tricas, adicionar contexto:

Pergunta: "Quantos carros vendemos este m√™s?"
Resposta: "15 vendas
üìä Insights:
‚Ä¢ 75% da meta mensal atingida
‚Ä¢ 5 vendas acima do m√™s passado (+50%)
‚Ä¢ Jo√£o Silva liderou com 6 vendas"
6. PERGUNTAS COMPLEXAS QUE O VELOBOT DEVE RESPONDER
Implemente capacidade de responder:

‚úÖ "Qual vendedor est√° performando melhor este m√™s?"
‚úÖ "Quantos follow-ups tenho pendentes?"
‚úÖ "Quais ve√≠culos est√£o sem documenta√ß√£o?"
‚úÖ "Qual foi meu lucro l√≠quido no m√™s passado?"
‚úÖ "Quanto tempo em m√©dia leva para preparar um carro?"
‚úÖ "Quais despesas est√£o vencendo esta semana?"
‚úÖ "Quantos custos est√£o aguardando aprova√ß√£o?"
‚úÖ "Quanto tempo a [marca modelo] ficou na oficina?"
‚úÖ "Quais carros est√£o parados h√° mais de 7 dias?"
7. ESTRUTURA DO PROMPT DO SISTEMA
Atualize o veloStockSystemPrompt com:

## CONTEXTO COMPLETO DO SISTEMA:
${vehiclesContext}
${leadsContext}
${observationsContext}
${soldContext}
${costsContext}
${billsContext}
${commissionsContext}
${followUpsContext}           // NOVO
${remindersContext}           // NOVO
${costApprovalsContext}       // NOVO
${operationalExpensesContext} // NOVO
${sellersPerformanceContext}  // NOVO
${documentsStatusContext}     // NOVO
${activityLogContext}         // NOVO
${repairHistoryContext}       // NOVO (quando contexto sobre reparos)
## REGRAS DE FORMATA√á√ÉO:
1. Perguntas quantitativas: responda APENAS o n√∫mero
2. Perguntas qualitativas: use listas organizadas com emojis
3. Mantenha contexto da conversa (ve√≠culo/t√≥pico em discuss√£o)
4. N√ÉO adicione "Se precisar de mais informa√ß√µes..."
5. Seja CONCISO e DIRETO
CHECKLIST DE IMPLEMENTA√á√ÉO
Fase 1: Expandir Dados (Prioridade Alta)
 Adicionar query de follow-ups pendentes
 Adicionar query de reminders ativos
 Adicionar query de aprova√ß√µes de custos
 Adicionar query de despesas operacionais
 Adicionar query de vendedores com m√©tricas
Fase 2: Consci√™ncia de Contexto
 Implementar detec√ß√£o de ve√≠culo mencionado
 Implementar detec√ß√£o de t√≥pico da conversa
 Guardar ve√≠culo em contexto entre mensagens
 Filtrar dados por contexto (ex: custos apenas do ve√≠culo em discuss√£o)
Fase 3: Hist√≥rico Temporal
 Implementar c√°lculo de dias por localiza√ß√£o
 Formatar resposta de tempo em oficinas
 Adicionar ao contexto quando t√≥pico = prepara√ß√£o/reparos
Fase 4: Formata√ß√£o de Respostas
 Atualizar prompt com regras de formata√ß√£o
 Adicionar exemplos de respostas corretas/incorretas
 Implementar detec√ß√£o de tipo de pergunta (quantitativa vs qualitativa)
Fase 5: Insights Autom√°ticos
 Adicionar c√°lculos de tend√™ncias (compara√ß√£o com m√™s anterior)
 Adicionar an√°lise de desempenho (% da meta)
 Adicionar sugest√µes baseadas em dados
EXEMPLO DE SA√çDA ESPERADA
Antes:

User: Quanto tempo a Compass ficou na oficina?
VeloBot: A Compass passou por reparos e est√° em boas condi√ß√µes.
Depois:

User: Quanto tempo a Compass ficou na oficina?
VeloBot: üîß Compass Sport Branca - Hist√≥rico de Reparos:
‚Ä¢ Oficina do Aur√©lio: 3 dias
‚Ä¢ Paulo (Est√©tica): 8 dias
‚Ä¢ Total: 11 dias em prepara√ß√£o
CRIT√âRIOS DE SUCESSO
‚úÖ VeloBot responde TODAS as 10+ perguntas complexas listadas
‚úÖ Respostas formatadas de forma limpa (sem "fluff")
‚úÖ Mant√©m contexto entre mensagens
‚úÖ Fornece insights autom√°ticos quando relevante
‚úÖ Calcula tempo em localiza√ß√µes espec√≠ficas

IMPORTANTE
N√ÉO fa√ßa altera√ß√µes em package.json, vite.config.ts ou .replit
FOQUE apenas em server/routes/ai.ts e l√≥gica do chatbot
TESTE cada funcionalidade ap√≥s implementar
Use o token budget de 500-600 tokens para respostas completas
IMPLEMENTE TUDO AGORA. O VeloBot precisa ser ONISCIENTE! üöÄ